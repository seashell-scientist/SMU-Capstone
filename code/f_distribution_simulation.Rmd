---
title: "Capstone"
author: "Jenna Ford, Christian Nava, Jonathan Tan"
date: "5/21/2020"
output:
  rmdformats::readthedown:
    highlight: kate
---

```{r setup, include=FALSE}
library(rmdformats)
library(tidyverse)  # data manipulaiton
library(data.table)
library(tswge)  # Time series package
library(tseries)  # for Dickey-Fuller test 
library(orcutt)  # for Cochrane-Orcutt test
library(formattable)  # for table formatting
library(GGally)
library(astsa)
library(nnfor)
library(dplyr)
library(ggplot2)
library(changepoint)
library(date)
library(R.devices)
library(sjPlot)
knitr::opts_chunk$set(echo = TRUE,
               prompt = FALSE,
               tidy = TRUE,
               comment = NA,
               message = FALSE,
               warning = FALSE)
```

***
# F Statistic Simulation
***
Jenna Ford, Christian Nava and Jonathan Tan  
May 21, 2020

```{r}
results <- data.frame(EM_ASE=double(),
                      ARMA_ASE=double(),
                      F_statistic=double(),
                      stringsAsFactors = FALSE)

trainingSize = 60
horizon = 2


for(j in 1:1000) {
  nulldev()
  x = gen.arma.wge(84,phi=c(1.6,-.9),theta=.8)
  dev.off()
  EM_ASEHolder = numeric()
  ARMA_ASEHolder = numeric()
  
  for( k in 1:(84-(trainingSize + horizon) + 1))
  {
    #Equal Means Model
    sink("file")
    model0_mean = mean(x[k:(k+(trainingSize-1))])
    EM_ASE = mean((x[(trainingSize+k):(trainingSize+ k + horizon - 1)] - model0_mean)^2)
    EM_ASEHolder[k] = EM_ASE
    sink()
    
    #ARMA Model
    sink("file")
    model1 = invisible(aic.wge(x[k:(k+(trainingSize-1))],type="aic"))
    model1_est = invisible(est.arma.wge(x[k:(k+(trainingSize-1))],p=model1$p,q=model1$q))
    forecasts = fore.aruma.wge(x[k:(k+(trainingSize-1))],phi = model1_est$phi, theta = model1_est$theta, s = 0, d = 0,n.ahead = horizon,plot=FALSE)
    ARMA_ASE = mean((x[(trainingSize+k):(trainingSize+ k + horizon - 1)] - forecasts$f)^2)
    ARMA_ASEHolder[k] = ARMA_ASE
    sink()
  }
  
  EM_WindowedASE = mean(EM_ASEHolder)
  ARMA_WindowedASE = mean(ARMA_ASEHolder)
  results[j,"EM_ASE"] = EM_WindowedASE
  results[j,"ARMA_ASE"] = ARMA_WindowedASE
  results[j,"F_statistic"] = EM_WindowedASE/ARMA_WindowedASE
}

ylim <- range(0,1)
xlim <- range(0,8)
x <- seq(0,8,0.01)
d <- density(results$F_statistic)
plot(d,xlim=xlim,ylim=ylim,main="F-Statistic Distribution for Equal Means/ARMA Rolling Window ASEs",xlab="")
curve(df(x,22,22),add=T,col='blue')
legend(6,1,legend=c("Equal Means/ARMA","F Distribution DF=22,22"),col=c("black","blue"),lty=1:1, cex=0.8)
```
